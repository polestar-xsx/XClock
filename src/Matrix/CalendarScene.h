#ifndef __CALENDAR_H__
#define __CALENDAR_H__

#include "Dot2D/dot2d.h"
#include "../RTC/SD3078.h"

NS_DT_BEGIN

typedef enum
{
	State_MonthDis = 0,
	State_MonthSet = 1,
	State_DaySet,
}tenMonthState;

class CalYearScene : public Scene
{

protected:
    bool init() override;

public:

    STATIC_CREATE(CalYearScene);

};


class YearLayer : public Layer
{
protected:
    TextSprite *YearH = nullptr;
    SpriteCanvas *YearHcanvas = nullptr;
    TextSprite *YearL = nullptr;
    SpriteCanvas *YearLcanvas = nullptr;
    tst3078Time ClockTime;
	tst3078Time ClockTimeSetting;
	QueueHandle_t TimeSettingQ;
	uint8_t ColorIndex = 0;
	bool boYearSetting = false;
public:
	
    STATIC_CREATE(YearLayer);

    virtual bool initLayer();

    void YearUpdate(float dt);

	void BtnClickHandler(int8_t, Event*);

	void BtnLongPressStartHandler(int8_t, Event*);

	void BtnDuringLongPressHandler(int8_t, Event*);

	void SendSettingYear(tst3078Time*);

};

class CalMonthScene : public Scene
{

protected:
    bool init() override;

public:

    STATIC_CREATE(CalMonthScene);

};


class MonthLayer : public Layer
{
protected:
    TextSprite *Month = nullptr;
    SpriteCanvas *Monthcanvas = nullptr;
    TextSprite *Day = nullptr;
    SpriteCanvas *Daycanvas = nullptr;
	TextSprite *Split = nullptr;
	SpriteCanvas *Splitcanvas = nullptr;
    tst3078Time ClockTime;
	tst3078Time ClockTimeSetting;
	QueueHandle_t TimeSettingQ;
	uint8_t ColorIndex = 0;
	tenMonthState enMonthState = State_MonthDis;
public:
	
    STATIC_CREATE(MonthLayer);

    virtual bool initLayer();

    void MonthUpdate(float dt);

	void BtnClickHandler(int8_t, Event*);

	void BtnLongPressStartHandler(int8_t, Event*);

	void BtnDuringLongPressHandler(int8_t, Event*);

	void MonthStateMachine(int8_t,int8_t);

	void SendSettingMonth(tst3078Time*);

};


/*************icon of calendar,bmp*************/
const unsigned char icon_calendar[] PROGMEM  = {
	0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x08, 0x00, 0x08, 0x00, 0xA1, 0x01, 0x00, 0xFF, 0x00, 0x00, 
	0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0xFF, 0x0B, 0x4E, 0x45, 0x54, 0x53, 
	0x43, 0x41, 0x50, 0x45, 0x32, 0x2E, 0x30, 0x03, 0x01, 0x00, 0x00, 0x00, 0x21, 0xF9, 0x04, 0x05, 
	0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 0x0C, 
	0x84, 0x6F, 0xA1, 0xCB, 0x91, 0xED, 0x60, 0x84, 0x80, 0x3E, 0x19, 0x0A, 0x00, 0x21, 0xF9, 0x04, 
	0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 
	0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 0xAD, 0x40, 0x7B, 0x4C, 0x42, 0x0A, 0x55, 0x01, 0x00, 0x21, 
	0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 
	0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 0xAD, 0x40, 0x7B, 0x50, 0x32, 0x0A, 0x55, 0x01, 
	0x00, 0x21, 0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 
	0x08, 0x00, 0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 0x0D, 0x9A, 0x7A, 0x32, 0x32, 0x2A, 
	0x55, 0x01, 0x00, 0x21, 0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 
	0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 0x0D, 0x9A, 0x7A, 0x2C, 
	0xC6, 0x9A, 0xE4, 0x2A, 0x00, 0x21, 0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 0x00, 0x00, 
	0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 0xAD, 0x00, 
	0x74, 0x53, 0x42, 0x3B, 0x43, 0x01, 0x00, 0x21, 0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 0x00, 0x2C, 
	0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 0xCB, 0x71, 
	0x0D, 0x1C, 0x4C, 0x2C, 0xC6, 0x4A, 0xDB, 0x2A, 0x00, 0x21, 0xF9, 0x04, 0x05, 0x64, 0x00, 0x02, 
	0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x08, 0x00, 0x00, 0x02, 0x0D, 0x84, 0x6F, 0xA1, 
	0xCB, 0x71, 0x0D, 0x1C, 0x4C, 0x4D, 0xB2, 0x57, 0x57, 0x01, 0x00, 0x3B
};

NS_DT_END

#endif //__CALENDAR_H__